<!DOCTYPE html>
<html>
<head>
  <title>PSY360 Survey</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
      margin: 0;
      padding: 20px;
      color: #333;
    }

    h2 {
      text-align: center;
      color: #2c3e50;
    }

    #instructions {
      background-color: #e8f0fe;
      border-left: 5px solid #4285f4;
      padding: 15px 20px;
      margin-bottom: 20px;
      border-radius: 5px;
    }

    form {
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      max-width: 600px;
      margin: 0 auto;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    p {
      margin-bottom: 10px;
    }

    label {
      display: block;
      margin: 5px 0;
    }

    input[type="email"] {
      width: 100%;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ccc;
      margin-top: 5px;
      box-sizing: border-box;
    }

    button {
      background-color: #4285f4;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 15px;
    }

    button:hover {
      background-color: #357ae8;
    }

    .question {
      margin-bottom: 30px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }
  </style>
</head>
<body>
  <h2>PSY360 Survey</h2>
  <div id="instructions">
    <p>Please read the instructions carefully before starting the survey:</p>
    <ul>
      <li>For each of the following scenarios, pretend a friend is asking you for advice and choose the answer you would be most likely to give.</li>
      <li>Answer all questions thoughtfully and honestly.</li>
      <li>Providing your email is optional.</li>
      <li>Once finished, click "Submit" to send your responses.</li>
    </ul>
  </div>
  <form id="surveyForm">
    <div id="questions"></div>
    <p>
      <label for="email"><strong>Email</strong> (optional, if you want to be entered into the draw):</label><br>
      <input type="email" id="email" name="email" placeholder="you@example.com">
    </p>
    <button type="submit" id="submitBtn">Submit</button>
  <span id="submitMessage" style="margin-left:10px; color:#555;">Please click only once, it may take a few seconds.</span>


  </form>

  <script>
    // === Step 1: define question variants ===
    const questions = [
      { id: 'Q1', variants: [
          { text: 'I have the option to take one of two classes this semester. The first class is on a topic that interests me, but the workload is heavy. The other class has a lighter workload and I have some friends taking it, but I’m not as interested in the material. Which class should I take?', variant_id: 'A', options: ['Take the first class', 'Take the second class']},
          { text: 'I have the option to take one of two classes this semester. The first class is on a topic that interests me, but the workload is heavy. The other class has a lighter workload and I have some friends taking it, but I’m not as interested in the material. The second class might be boring, but I’m worried the first class might be too stressful along with the other courses I’m taking this semester. Which class should I take?', variant_id: 'B', options: ['Take the first class', 'Take the second class']},
          { text: 'I have the option to take one of two classes this semester. The first class is on a topic that interests me, but the workload is heavy. The other class has a lighter workload and I have some friends taking it, but I’m not as interested in the material. However, I’m worried that the first class might be too stressful along with the other courses I’m taking this semester. Which class should I take?', variant_id: 'C', options: ['Take the first class', 'Take the second class']}
      ]},
      { id: 'Q2', variants: [
          { text: 'Today I got a summer internship offer that I have to respond to within a week. I’m still in the process of interviewing for a second internship that I would prefer, but they can’t give me a decision in the next week, so I can either take the offer I currently have or reject it and wait to hear from the second company (but potentially get rejected). Should I take the offer I currently have?', variant_id: 'A', options: ['Take the offer', 'Reject the offer']},
          { text: 'Today I got a summer internship offer that I have to respond to within a week. I’m still in the process of interviewing for a second internship that I would prefer, but they can’t give me a decision in the next week, so I can either take the offer I currently have or reject it and wait to hear from the second company (but potentially get rejected). Taking the offer from the first company is safer, but I also know I would enjoy the work at the second company more. Should I take the offer I currently have?', variant_id: 'B', options: ['Take the offer', 'Reject the offer']},
          { text: 'Today I got a summer internship offer that I have to respond to within a week. I’m still in the process of interviewing for a second internship that I would prefer, but they can’t give me a decision in the next week, so I can either take the offer I currently have or reject it and wait to hear from the second company (but potentially get rejected). I also know I would enjoy the work at the second company more. Should I take the offer I currently have?', variant_id: 'C', options: ['Take the offer', 'Reject the offer']}
      ]},
      { id: 'Q3', variants: [
          { text: 'A good friend is having a birthday dinner on the same day I planned to prepare for an exam. Should I go to the dinner or prioritize studying?', variant_id: 'A', options: ['Go to the dinner', 'Study for your exam']},
          { text: 'A good friend is having a birthday dinner on the same day I planned to prepare for an exam. I’m stressed about the exam, but it’s important to me to be there for my friend. Should I go to the dinner or prioritize studying?', variant_id: 'B', options: ['Go to the dinner', 'Study for your exam']},
          { text: 'A good friend is having a birthday dinner on the same day I planned to prepare for an exam. It’s important to me to be there for my friend. Should I go to the dinner or prioritize studying?', variant_id: 'C', options: ['Go to the dinner', 'Study for your exam']}
      ]},
      { id: 'Q4', variants: [
          { text: 'My roommate occasionally throws away food in our common room trash can that makes the room smell bad. Should I confront her about it or just take out the trash myself?', variant_id: 'A', options: ['Confront your roommate', 'Take out the trash yourself']},
          { text: 'My roommate occasionally throws away food in our common room trash can that makes the room smell bad. It’s not really my job to clean up after her, but I want to maintain a conflict-free relationship with her. Should I confront her about it or just take out the trash myself?', variant_id: 'B', options: ['Confront your roommate', 'Take out the trash yourself']},
          { text: 'My roommate occasionally throws away food in our common room trash can that makes the room smell bad. I want to maintain a conflict-free relationship with her. Should I confront her about it or just take out the trash myself?', variant_id: 'C', options: ['Confront your roommate', 'Take out the trash yourself']}
      ]},
      { id: 'Q5', variants: [
          { text: 'Over fall break, my high school friends asked me to get together. However, my family had planned to see a movie together at the same time. What should I do?', variant_id: 'A', options: ['Meet up with friends', 'See movie with family']},
          { text: 'Over fall break, my high school friends asked me to get together. However, my family had planned to see a movie together at the same time. I don’t want to disappoint my family, but I miss my high school friends. What should I do?', variant_id: 'B', options: ['Meet up with friends', 'See movie with family']},
          { text: 'Over fall break, my high school friends asked me to get together. However, my family had planned to see a movie together at the same time. I miss my high school friends. What should I do?', variant_id: 'C', options: ['Meet up with friends', 'See movie with family']}
      ]},
      { id: 'Q6', variants: [
          { text: 'A friend is upset with me but won’t tell me why, and just gives me vague answers whenever I bring it up. Should I push for a conversation or give them space?', variant_id: 'A', options: ['Push for a conversation', 'Give them space']},
          { text: 'A friend is upset with me but won’t tell me why, and just gives me vague answers whenever I bring it up. I want to understand what’s wrong, but fear that I’m being too pushy. Should I push for a conversation or give them space?', variant_id: 'B', options: ['Push for a conversation', 'Give them space']},
          { text: 'A friend is upset with me but won’t tell me why, and just gives me vague answers whenever I bring it up. I fear that I’m being too pushy. Should I push for a conversation or give them space?', variant_id: 'C', options: ['Push for a conversation', 'Give them space']}
      ]},
    ];

    // === Step 2: randomize variant selection ===
    /*
    const chosen = questions.map(q => {
      const choice = q.variants[Math.floor(Math.random() * q.variants.length)];
      return { id: q.id, text: choice.text, variant: choice.variant_id, options: choice.options };
    });
    */
   // === Step 2: randomize variant selection (with localStorage) ===
  let chosen = JSON.parse(localStorage.getItem('surveyChosen')); // check if saved

  if (!chosen) {
    // Pick random variants for first-time visitor
    chosen = questions.map(q => {
      const choice = q.variants[Math.floor(Math.random() * q.variants.length)];
      return { id: q.id, text: choice.text, variant: choice.variant_id, options: choice.options };
    });
    // Save to localStorage so the same user sees same variants on reload
    localStorage.setItem('surveyChosen', JSON.stringify(chosen));
  }

    // === Step 3: render the questions ===
    const div = document.getElementById('questions');
    chosen.forEach(q => {
  let optionsHtml = q.options.map(opt => `
    <label><input type="radio" name="${q.id}" value="${opt}" required> ${opt}</label>
  `).join('');
  
  div.innerHTML += `
    <div class="question">
      <p><b>${q.text}</b></p>
      ${optionsHtml}
    </div>
  `;
});

    // === Step 4: handle submission ===
    document.getElementById('surveyForm').addEventListener('submit', e => {
      e.preventDefault();
      const formData = new FormData(e.target);

      const payload = {
        participant_id: Math.random().toString(36).substring(2, 9), // random ID
        Q1_variant: chosen[0].variant,
        Q1_response: formData.get('Q1'),
        Q2_variant: chosen[1].variant,
        Q2_response: formData.get('Q2'),
        Q3_variant: chosen[2].variant,
        Q3_response: formData.get('Q3'),
        Q4_variant: chosen[3].variant,
        Q4_response: formData.get('Q4'),
        Q5_variant: chosen[4].variant,
        Q5_response: formData.get('Q5'),
        Q6_variant: chosen[5].variant,
        Q6_response: formData.get('Q6'),
        email: formData.get('email') || null
      };

      // === Step 5: send to Google Apps Script ===
      fetch('https://script.google.com/macros/s/AKfycbypbzKFCMxy8kJrqQ_q64gPf-JoeI69djarsf96bxX0meV0GZUFnghDHWkiWH6BfGaOZA/exec', { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) }) .then(() => { alert('Thank you so much! Your responses were submitted.'); e.target.reset(); }) .catch(err => alert('Error submitting survey: ' + err));
});
  </script>
</body>
</html>
